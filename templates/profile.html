{% extends 'base.html' %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-blue-50 to-gray-100 flex justify-center items-start py-12 px-4">
  <div class="w-full max-w-4xl bg-white/70 backdrop-blur-xl rounded-2xl shadow-xl p-8 space-y-10">

    <!-- Header -->
    <div class="flex flex-col items-center text-center">
      <div class="relative">
        <div id="profile-pic-container" class="w-32 h-32 rounded-full overflow-hidden ring-4 ring-white shadow-md hover:scale-105 transition-transform duration-300">
          {% if profile_pic %}
            <img id="profile-pic-img" src="{{ url_for('static', filename='uploads/' ~ profile_pic) }}" alt="Profile Picture" class="w-full h-full object-cover">
          {% else %}
            <div id="profile-pic-img" class="w-full h-full bg-gray-200 flex items-center justify-center text-gray-400 text-2xl font-bold">
              {{ current_user.name[0]|upper if current_user.name else 'U' }}
            </div>
          {% endif %}
        </div>
        <label class="absolute bottom-0 right-0 bg-black text-white text-xs px-2 py-1 rounded-full cursor-pointer hover:bg-gray-800">
          Change
          <input id="profile-pic-input" type="file" name="profile_pic" class="hidden" accept="image/*">
        </label>
      </div>
      <h2 class="mt-4 text-2xl font-bold text-gray-800">{{ current_user.name or "Your Name" }}</h2>
      <p class="text-gray-500">Skill Swap Enthusiast ðŸš€</p>
    </div>

    <!-- Tabs -->
    <div>
      <div class="flex justify-center space-x-4 mb-6">
        <button type="button" class="tab-btn px-4 py-2 rounded-lg font-medium bg-black text-white" data-tab="bio">Bio</button>
        <button type="button" class="tab-btn px-4 py-2 rounded-lg font-medium bg-gray-200 hover:bg-gray-300" data-tab="offered">Offered Skills</button>
        <button type="button" class="tab-btn px-4 py-2 rounded-lg font-medium bg-gray-200 hover:bg-gray-300" data-tab="wanted">Wanted Skills</button>
      </div>

      <form method="post" enctype="multipart/form-data" class="space-y-6">

        <!-- Bio -->
        <div id="tab-bio" class="tab-content">
          <label class="block font-semibold mb-2">About You</label>
          <textarea name="bio" rows="4" class="w-full p-4 border border-gray-300 rounded-xl shadow-sm focus:ring-2 focus:ring-blue-400" placeholder="Tell others a bit about yourself...">{{ bio or '' }}</textarea>
        </div>

        <!-- Offered Skills -->
        <div id="tab-offered" class="tab-content hidden">
          <label class="block font-semibold mb-2">Skills You Offer</label>
          <div id="offered-skills" class="flex flex-wrap gap-2 mb-2"></div>
          <input id="offered-input" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-400" placeholder="Type a skill and press Enter" />
          <input type="hidden" name="offered" id="offered-hidden" value="{{ offered_skills|join(',') if offered_skills else '' }}">
        </div>

        <!-- Wanted Skills -->
        <div id="tab-wanted" class="tab-content hidden">
          <label class="block font-semibold mb-2">Skills You Want</label>
          <div id="wanted-skills" class="flex flex-wrap gap-2 mb-2"></div>
          <input id="wanted-input" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-green-400" placeholder="Type a skill and press Enter" />
          <input type="hidden" name="wanted" id="wanted-hidden" value="{{ wanted_skills|join(',') if wanted_skills else '' }}">
        </div>

        <!-- Save -->
        <div class="text-center pt-6">
          <button type="submit" class="px-8 py-3 rounded-xl bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold shadow-lg hover:opacity-90 transition">
            Save Profile
          </button>
        </div>
      </form>
    </div>

    <!-- Showcase -->
    <div class="mt-10">
      <h3 class="text-xl font-bold text-gray-800 mb-4">Your Skills</h3>
      <div class="grid md:grid-cols-2 gap-6">

        <div>
          <h4 class="font-semibold text-gray-700 mb-2">ðŸ’¡ Offered Skills</h4>
          <div id="offered-showcase" class="flex flex-wrap gap-2">
            {% for skill in offered_skills %}
              <span class="px-3 py-1 rounded-full text-sm bg-blue-100 text-blue-800 shadow-sm">{{ skill }}</span>
            {% else %}
              <p class="text-gray-400">No skills added yet.</p>
            {% endfor %}
          </div>
        </div>

        <div>
          <h4 class="font-semibold text-gray-700 mb-2">ðŸŽ¯ Wanted Skills</h4>
          <div id="wanted-showcase" class="flex flex-wrap gap-2">
            {% for skill in wanted_skills %}
              <span class="px-3 py-1 rounded-full text-sm bg-green-100 text-green-800 shadow-sm">{{ skill }}</span>
            {% else %}
              <p class="text-gray-400">No skills added yet.</p>
            {% endfor %}
          </div>
        </div>

      </div>
    </div>

  </div>
</div>

<script>
  // Tabs
  const tabs = document.querySelectorAll(".tab-btn");
  const contents = document.querySelectorAll(".tab-content");
  tabs.forEach(tab => {
    tab.addEventListener("click", () => {
      tabs.forEach(t => t.className = "tab-btn px-4 py-2 rounded-lg font-medium bg-gray-200 hover:bg-gray-300");
      tab.className = "tab-btn px-4 py-2 rounded-lg font-medium bg-black text-white";
      contents.forEach(c => c.classList.add("hidden"));
      document.getElementById("tab-" + tab.dataset.tab).classList.remove("hidden");
    });
  });

  // Profile pic preview
  const profilePicInput = document.getElementById('profile-pic-input');
  const profilePicImg = document.getElementById('profile-pic-img');
  profilePicInput?.addEventListener('change', function() {
    const file = this.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      if (profilePicImg.tagName === 'IMG') {
        profilePicImg.src = e.target.result;
      } else {
        const img = document.createElement('img');
        img.id = 'profile-pic-img';
        img.src = e.target.result;
        img.className = 'w-full h-full object-cover';
        profilePicImg.replaceWith(img);
      }
    };
    reader.readAsDataURL(file);
  });

  // Skills input
  function setupSkillInput(inputId, containerId, hiddenInputId) {
    const input = document.getElementById(inputId);
    const container = document.getElementById(containerId);
    const hiddenInput = document.getElementById(hiddenInputId);

    let skills = hiddenInput.value ? hiddenInput.value.split(',').map(s => s.trim()).filter(Boolean) : [];

    function updateHidden() { hiddenInput.value = skills.join(','); }
    function renderSkills() {
      container.innerHTML = '';
      skills.forEach((skill, index) => {
        const tag = document.createElement('span');
        tag.className = 'px-3 py-1 rounded-full text-sm flex items-center gap-1 bg-gray-100 text-gray-700 shadow-sm';
        tag.innerHTML = `${skill} <button type="button" class="ml-1">&times;</button>`;
        container.appendChild(tag);
      });
      updateHidden();
    }

    input.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ',') {
        e.preventDefault();
        const value = input.value.trim();
        if (value && !skills.includes(value)) {
          skills.push(value);
          renderSkills();
          input.value = '';
        }
      }
    });

    container.addEventListener('click', function(e) {
      if (e.target.tagName === 'BUTTON') {
        const idx = [...container.children].indexOf(e.target.parentElement);
        skills.splice(idx, 1);
        renderSkills();
      }
    });

    renderSkills();
  }

  setupSkillInput('offered-input', 'offered-skills', 'offered-hidden');
  setupSkillInput('wanted-input', 'wanted-skills', 'wanted-hidden');
</script>
{% endblock %}
